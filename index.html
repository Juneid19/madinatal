<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Firza Radio Madina</title>
<style>
  * {margin:0; padding:0; box-sizing:border-box;}
  body {
    font-family:'Segoe UI', sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background:linear-gradient(135deg,#667eea,#764ba2);
    transition:background 1s ease;
    overflow:hidden;
  }
  .player {
    text-align:center;
    padding:40px;
    border-radius:25px;
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(20px);
    box-shadow:0 0 40px rgba(0,0,0,0.4);
    width:90%;
    max-width:400px;
  }
  .cover-wrap {
    position: relative;
    width: 250px;
    height: 250px;
    margin: 0 auto 25px;
  }
  .ring {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 250px;
    height: 250px;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    background: conic-gradient(#ff006e, #8338ec, #3a86ff, #06c, #ff006e);
    animation: spin 3s linear infinite, pulse 2s ease-in-out infinite;
    filter: blur(2px);
    opacity: .8;
  }
  .cover {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 220px;
    height: 220px;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 0 25px rgba(0,0,0,0.5);
    animation: rotate 10s linear infinite;
  }
  @keyframes spin {
    from {transform:translate(-50%,-50%) rotate(0deg);}
    to {transform:translate(-50%,-50%) rotate(360deg);}
  }
  @keyframes pulse {
    0%,100% {opacity:.8; transform:translate(-50%,-50%) scale(1);}
    50% {opacity:1; transform:translate(-50%,-50%) scale(1.05);}
  }
  @keyframes rotate {
    from {transform:translate(-50%,-50%) rotate(0deg);}
    to {transform:translate(-50%,-50%) rotate(360deg);}
  }
  .paused {animation-play-state:paused;}
  
  /* CONTAINER UNTUK JUDUL LAGU */
  .title-container {
    width: 100%;
    overflow: hidden;
    position: relative;
    margin-bottom: 5px;
    min-height: 30px;
    display: flex;
    justify-content: center;
  }
  
  #title {
    color:#fff;
    white-space: nowrap;
    display: inline-block;
    font-size: 1.5rem;
    transition: all 0.3s ease;
    text-align: center;
  }
  
  /* Mode berjalan untuk judul panjang */
  #title.marquee {
    animation: marquee 15s linear infinite;
    animation-delay: 1s;
    padding-right: 50px; /* Memberi ruang untuk efek berjalan */
  }
  
  @keyframes marquee {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
  
  /* Mode diam untuk judul pendek */
  #title.static {
    transform: none !important;
    animation: none;
    width: auto;
    max-width: 100%;
    text-overflow: ellipsis;
    overflow: hidden;
  }
  
  h4 {color:#ddd; margin-bottom:10px;}

  /* üñ§ LIVE text hitam + bayangan putih lembut */
  .radio-name {
    color:#000;
    font-weight:bold;
    margin-bottom:20px;
    text-shadow:1px 1px 4px rgba(255,255,255,0.7);
    letter-spacing:0.5px;
  }

  /* Tombol sejajar */
  .controls {
    display:flex;
    justify-content:center;
    align-items:center;
    gap:20px;
    margin:15px 0;
  }
  button {
    background:rgba(255,255,255,0.2);
    color:white;
    border:none;
    border-radius:50%;
    width:60px; height:60px;
    cursor:pointer;
    font-size:22px;
    transition:.3s;
    box-shadow:0 0 10px rgba(255,255,255,0.2);
  }
  button:hover {
    background:rgba(255,255,255,0.3);
    transform:scale(1.1);
    box-shadow:0 0 20px rgba(255,255,255,0.5);
  }

  .listeners {
    color:#fff;
    margin-top:10px;
    font-size:14px;
    opacity:.8;
  }
  
  /* Responsif untuk mobile */
  @media (max-width: 480px) {
    .cover-wrap {
      width: 200px;
      height: 200px;
    }
    .ring {
      width: 200px;
      height: 200px;
    }
    .cover {
      width: 180px;
      height: 180px;
    }
    .title-container {
      min-height: 25px;
    }
    #title {
      font-size: 1.3rem;
    }
  }
</style>
</head>
<body>
<div class="player">
  <div class="cover-wrap">
    <div class="ring"></div>
    <img id="cover" class="cover" src="https://frpadang.netlify.app/img/default.jpg" />
  </div>
  
  <!-- Container khusus untuk judul lagu -->
  <div class="title-container">
    <h2 id="title">Firza Radio Madina</h2>
  </div>
  
  <h4 id="artist">Streaming Live</h4>
  <div class="radio-name">LIVE ‚Ä¢ Madina</div>

  <div class="controls">
    <button id="refresh" title="Refresh">üîÑ</button>
    <button id="play" title="Play / Pause">‚ñ∂</button>
    <button id="stop" title="Stop">‚èπ</button>
  </div>

  <div class="listeners" id="listeners">Menunggu data...</div>
</div>

<audio id="audio" crossorigin="anonymous"></audio>

<script>
const idzeno = "b41be1un92quv";
const stream = "https://stream.zeno.fm/" + idzeno;
const fallbackCover = "https://mekarindah.netlify.app/img/default.jpg";
const audio = document.getElementById("audio");
const playBtn = document.getElementById("play");
const stopBtn = document.getElementById("stop");
const refreshBtn = document.getElementById("refresh");
const cover = document.getElementById("cover");
const titleEl = document.getElementById("title");
const artistEl = document.getElementById("artist");
const listeners = document.getElementById("listeners");
let isPlaying = false;
let lastTrack = "";

// --- DATABASE QARI/ARTIS ---
const qariDatabase = {
    'mishary': 'https://i.ytimg.com/vi/GLMp_EGGLfk/hq720.jpg?sqp=-oaymwExCK4FEIIDSFryq4qpAyMIARUAAIhCGAHwAQH4AdQGgALgA4oCDAgAEAEYciBWKDgwDw==&rs=AOn4CLAa_DZgLB8D4xcMTFPgxpnQghg_sw',
    'abdul': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT99qAcwhSDEUMmxHHzjEfna9YVgtg-04A8rDvXbaNtZf-70ZkRxFPl_i5J_he-DnfdtO7EhS0ouUaiu-hq_bE8Ni9U3xKBjsAdFgzAg4w&s=10',
    'adi hidayat': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQi7cw0cL0cs4aqyXA5sbBMBaCWGmW0D28pzruJKEWXlx9RYeQLuZouy9VlqLk9oWvOxlO7jHAh6QOXhjPyKPQZqz2rez4YV5XOPrgTTQ&s=10',
    'zainuddin': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSDo4WarU6dxMHRx3BFqisexu4euGqv9Ni9_JZA5jZBwA&s=10',
    'latif': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSgeut2z_VzZzl5_B7sbcdxL2FkG3Rd3dOTaS3WCOXEA&s=10',
    'al sudais': 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Abdulrahman_Al-Sudais.jpg/440px-Abdulrahman_Al-Sudais.jpg',
    'ghamdi': 'https://i.ibb.co/Wp0y1hG/ghamdi.jpg',
    'lili rahmah': 'https://cdn-images.dzcdn.net/images/cover/b2fb0265b6c2182f983df15c6d7e4b87/1900x1900-000000-80-0-0.jpg',
    'shatri': 'https://i.ibb.co/fQ5N204/shatri.jpg',
    'abdul basit': 'https://i.ibb.co/RzM805h/abdulbasit.jpg',
};

// --- WARNA BACKGROUND YANG AKAN DI-CYCLE ---
const colors = [
  'linear-gradient(135deg,#667eea,#764ba2)',
  'linear-gradient(135deg,#f093fb,#f5576c)',
  'linear-gradient(135deg,#4facfe,#00f2fe)',
  'linear-gradient(135deg,#fa709a,#fee140)',
  'linear-gradient(135deg,#30cfd0,#330867)',
  'linear-gradient(135deg,#ff6ec4,#7873f5)',
  'linear-gradient(135deg,#43e97b,#38f9d7)',
  'linear-gradient(135deg,#ff9a9e,#fad0c4)'
];
let colorIndex = 0;

audio.src = stream;
audio.volume = 0.7;

// --- FUNGSI UNTUK MENGATUR MODE JUDUL (BERJALAN ATAU STATIS) ---
function updateTitleMode() {
    const titleContainer = document.querySelector('.title-container');
    const titleWidth = titleEl.scrollWidth;
    const containerWidth = titleContainer.offsetWidth;
    
    // Hapus semua kelas sebelumnya
    titleEl.classList.remove('marquee', 'static');
    
    // Cek apakah teks lebih panjang dari container
    if (titleWidth > containerWidth) {
        // Mode berjalan untuk judul panjang
        titleEl.classList.add('marquee');
        console.log('Judul panjang, aktifkan mode berjalan');
    } else {
        // Mode statis (center) untuk judul pendek
        titleEl.classList.add('static');
        console.log('Judul pendek, mode statis (center)');
    }
}

// --- FUNGSI UNTUK GANTI BACKGROUND OTOMATIS ---
function cycleBackground() {
    colorIndex = (colorIndex + 1) % colors.length;
    document.body.style.background = colors[colorIndex];
}

// --- FUNGSI UNTUK GANTI BACKGROUND BERDASARKAN JUDUL LAGU ---
function changeBackgroundColor(seed) {
    // Gunakan hash untuk menentukan warna dari array
    const hash = seed.split('').reduce((a, c) => a + c.charCodeAt(0), 0);
    const idx = Math.abs(hash) % colors.length;
    document.body.style.background = colors[idx];
    // Update colorIndex agar cycle tetap berlanjut dari indeks ini
    colorIndex = idx;
}

// Panggil fungsi saat window di-resize
window.addEventListener('resize', updateTitleMode);

playBtn.onclick = () => {
  if (isPlaying) {
    audio.pause();
    cover.classList.add("paused");
    playBtn.textContent = "‚ñ∂";
  } else {
    audio.play();
    cover.classList.remove("paused");
    playBtn.textContent = "‚è∏";
  }
  isPlaying = !isPlaying;
};

stopBtn.onclick = () => {
  audio.pause();
  audio.currentTime = 0;
  isPlaying = false;
  cover.classList.add("paused");
  playBtn.textContent = "‚ñ∂";
};

refreshBtn.onclick = () => fetchNowPlaying(true);

// --- FUNGSI UNTUK MENCARI COVER ART QARI ---
function getQariCover(name) {
    const lowerName = name.toLowerCase().trim();
    for (const key in qariDatabase) {
        if (lowerName.includes(key)) {
            return qariDatabase[key];
        }
    }
    return null;
}

async function fetchNowPlaying(force = false) {
  try {
    const r = await fetch(`https://zenoplay.zenomedia.com/api/zenofm/nowplaying/${idzeno}/?_=${Date.now()}`, { cache: "no-store" });
    const data = await r.json();
    const currentTrack = (data.artist + " - " + data.title).trim();
    if (!force && currentTrack === lastTrack) return;
    lastTrack = currentTrack;
    updateInfo(data);
  } catch (e) {
    console.error(e);
    listeners.textContent = "Gagal memuat data";
  }
}

async function updateInfo(data) {
  let title = data.title?.trim() || "Firza Tapsel";
  let artist = data.artist?.trim() || "Streaming Live";
  let img = data.thumb;

  // Logika Pemisahan Title/Artist untuk format 'Artist - Title'
  if (title.includes(" - ") && (!data.artist || data.artist === "")) {
    const parts = title.split(" - ");
    artist = parts[0].trim();
    title = parts[1].trim();
  }

  // Cek Database Qari sebagai PRIORITAS UTAMA
  let qariCover = getQariCover(artist) || getQariCover(title); 
  
  if (qariCover) {
    img = qariCover;
    if (artist === "Streaming Live" || artist === "Firza Tapsel" || artist === data.artist) {
        let keyFound = Object.keys(qariDatabase).find(key => title.toLowerCase().includes(key));
        if (keyFound) {
            artist = keyFound.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            title = title.replace(new RegExp(keyFound, 'gi'), '').trim();
            if (title === "" || title.length < 3) title = "Murottal";
        }
    }
  }

  // Jika cover Zeno kosong dan Qari Cover juga kosong, baru coba iTunes (FALLBACK)
  if (!img || img === fallbackCover || img.includes('zenomedia')) {
      if (!qariCover) {
        try {
          const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(artist + " " + title)}&limit=1`, { cache: "no-store" });
          const j = await res.json();
          if (j.results?.length > 0) {
            img = j.results[0].artworkUrl100.replace("100x100", "600x600");
          }
        } catch (e) {
          console.warn("iTunes cover fetch failed:", e);
        }
    } else {
        img = qariCover;
    }
  }

  // Update judul dan artis
  titleEl.textContent = title;
  artistEl.textContent = artist;
  listeners.textContent = "üéµ Live dari Madina";

  // Update cover
  cover.src = img || fallbackCover;
  
  // Update mode judul (berjalan atau static)
  setTimeout(updateTitleMode, 10);
  
  // Update background berdasarkan judul lagu (hanya jika lagu berubah)
  changeBackgroundColor(title + artist);
}

// Inisialisasi awal
fetchNowPlaying();

// Update otomatis setiap 10 detik untuk metadata
setInterval(fetchNowPlaying, 10000);

// Update background otomatis setiap 20 detik (untuk cycle warna)
setInterval(cycleBackground, 20000);

// Jalankan updateTitleMode sekali saat halaman dimuat
setTimeout(updateTitleMode, 100);

// Mulai cycle background pertama kali
setTimeout(cycleBackground, 500); // Mulai setelah 0.5 detik
</script>
</body>
 </html>
